{% extends "base.html" %}

{% block head_extra %}
    <style>
    body {
        margin: 0;
        font-family: Calibri Light, sans-serif;
        background-color: #F2F2F2;
    }

    .container {
        max-width: 1000px;
        margin: 30px auto;
        background-color: #e0e0e0;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    h2 {
        text-align: center;
        margin-bottom: 20px;
        color: #333;
    }

    form {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        align-items: center;
        margin-bottom: 20px;
    }

    label {
        font-weight: bold;
    }

    input[type="date"] {
        padding: 5px;
        border-radius: 5px;
        border: 1px solid #ccc;
    }

    button {
        padding: 8px 16px;
        border: none;
        border-radius: 5px;
        background-color: #4CAF50;
        color: white;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

    button:hover {
        background-color: #45a049;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }

    th, td {
        text-align: left;
        padding: 12px;
        border-bottom: 1px solid #ddd;
    }

    th {
        background-color: #f0f0f0;
    }

    .alert {
        padding: 10px;
        border-radius: 5px;
        margin-bottom: 20px;
        font-weight: bold;
    }

    .alert.success {
        background-color: #d4edda;
        color: #155724;
    }

    .alert.error {
        background-color: #f8d7da;
        color: #721c24;
    }

    .flash-messages {
        margin-bottom: 20px;
    }

    @media (max-width: 600px) {
        form {
            flex-direction: column;
        }

        th, td {
            font-size: 14px;
        }
    }
    </style>
{% endblock %}

{% block content %}
<div class="container">
    <h2>Validação de Orçamentos</h2>

    <!-- Alert Box -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="flash-messages">
                {% for category, message in messages %}
                    <div class="alert {{ category }}">{{ message }}</div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <!-- Filtro por data -->
    <form method="get" action="{{ url_for('validar') }}">
        <label for="data_inicio">De:</label>
        <input type="date" id="data_inicio" name="data_inicio" required>

        <label for="data_fim">Até:</label>
        <input type="date" id="data_fim" name="data_fim" required>

        <button type="submit">Buscar</button>
    </form>

    {% if orcamentos %}
    <table>
        <thead>
        <tr>
            <th>Produto</th>
            <th>Fornecedor</th>
            <th>Valor</th>
            <th>Status</th>
            <th>Ação</th>
        </tr>
        </thead>
        <tbody>
        {% for o in orcamentos %}
        <tr>
            <td>{{ o.nome_produto }}</td>
            <td>{{ o.nome_fornecedor }}</td>
            <td>R$ {{ "%.2f"|format(o.vlr_orcamento) }}</td>
            <td>{{ o.status }}</td>
            <td>
            <form method="post" action="{{ url_for('validar') }}">
                <input type="hidden" name="id_orcamento" value="{{ o.id_orcamento }}">
                <input type="hidden" name="produto_id" value="{{ o.produto_id }}">
                <input type="hidden" name="data_inicio" value="{{ request.args.get('data_inicio') }}">
                <input type="hidden" name="data_fim" value="{{ request.args.get('data_fim') }}">
                <button type="submit">Validar</button>
            </form>
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}

<!--JS-->
<script></script>

{% endblock %}
