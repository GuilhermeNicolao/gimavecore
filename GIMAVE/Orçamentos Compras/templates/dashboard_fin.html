{% extends 'base.html' %}

{% block head_extra %}
    <style>
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
        font-family: "Calibri Light", Calibri, sans-serif;
        background-color: #f9f9f9;
        table-layout: auto;
    }

    th, td {
        padding: 10px;
        border: 1px solid #ccc;
        text-align: center;
        font-family: "Calibri Light", Calibri, sans-serif;
        white-space: nowrap;
    }

    th {
        background-color: #dadada;
        color: #333;
    }

    tbody tr:nth-child(odd) {
        background-color: #f9f9f9;
    }

    tbody tr:nth-child(even) {
        background-color: #f0f0f0;
    }

    form {
        margin-bottom: 20px;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        align-items: center;
    }

    input[type="date"],
    input[type="text"],
    select,
    button {
        padding: 6px 10px;
        border-radius: 4px;
        border: 1px solid #aaa;
        font-family: "Calibri Light", Calibri, sans-serif;
    }

    button {
        background-color: #4CAF50;
        color: white;
        cursor: pointer;
        border: none;
    }

    button:hover {
        background-color: #45a049;
    }

    h2 {
        text-align: center;
        margin-bottom: 20px;
        color: #333;
    }
    </style>
{% endblock %}

{% block content %}
<h2>RELATÓRIO DE ECONOMIA</h2>

<form method="get" action="{{ url_for('dashboard') }}">
    <label for="data_inicio">Data Início:</label>
    <input type="date" name="data_inicio" value="{{ request.args.get('data_inicio', '') }}" required>

    <label for="data_fim">Data Fim:</label>
    <input type="date" name="data_fim" value="{{ request.args.get('data_fim', '') }}" required>

    <label for="produto_id">Produto:</label>
    <select name="produto_id">
        <option value="">Todos</option>
        {% for produto in produtos %}
            <option value="{{ produto.id_produto }}" {% if request.args.get('produto_id') == produto.id_produto|string %}selected{% endif %}>
                {{ produto.nome }}
            </option>
        {% endfor %}
    </select>

    <button type="submit">GERAR RELATÓRIO</button>
</form>

{% if relatorio %}
    <table>
        <thead>
        <tr>
            <th>Data</th>
            <th>Produto</th>
            <th>Fornecedor Aprovado</th>
            <th>Valor Aprovado</th>
            <th>Fornecedor Mais Caro</th>
            <th>Maior Valor Reprovado</th>
            <th>Economia</th>
        </tr>
        </thead>
        <tbody>
        {% for item in relatorio %}
        <tr>
            <td>{{ item.data.strftime('%d/%m/%Y') }}</td>
            <td>{{ item.nome_produto }}</td>
            <td>{{ item.fornecedor_aprovado }}</td>
            <td>R$ {{ "{:,.2f}".format(item.valor_aprovado).replace(",", "X").replace(".", ",").replace("X", ".") }}</td>
            <td>{{ item.fornecedor_reprovado }}</td>
            <td>R$ {{ "{:,.2f}".format(item.maior_reprovado).replace(",", "X").replace(".", ",").replace("X", ".") }}</td>
            <td><strong style="color: green">R$ {{ "{:,.2f}".format(item.economia).replace(",", "X").replace(".", ",").replace("X", ".") }}</strong></td>
        </tr>
        {% endfor %}
        </tbody>
    </table>

    <h3>Total Economia: R$ {{ "{:,.2f}".format(total_economia).replace(",", "X").replace(".", ",").replace("X", ".") }}</h3>
{% endif %}

{% endblock %}
